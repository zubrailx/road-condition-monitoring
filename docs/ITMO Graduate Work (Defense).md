# Предзащита

## Слайд 1 (Титульник)

Здравствуйте, уважаемая комиссия. Меня зовут Кулаков Никита. Тема моей выпускной квалификационной работы: "Автоматизация отслеживания состояния дорожных покрытий при помощи мобильных устройств водителей".

## Слайд 2 (Проблема)

Проблема качества дорог является важной в наше время: она влияет как на безопасность водителей, так и на экономику, например, согласно исследованиям, из-за плохих дорог увеличивается стоимость содержания транспортных средств и время вождения. 

Кроме того, проведение несвоевременного ремонта увеличивает стоимость обслуживания дорожных участков. 

Перед проведение ремонтных работ предварительно необходимо выявить сами дефекты. Для этого, как правило, нанимаются бригады, подготавливаются передвижные лаборатории со сложными приборами, такими как ультрозвуковые датчики. Безусловно, такой подход, является достаточно точным, но требует большого количества времени и средств. Альтернативным ему является сбор данных при помощи мобильных устройств водителей. Благодаря своей простоте данный вариант может быть полезен, например, если нет возможности быстрой организации бригад, или если необходимо провести анализ на большой территории.

## Слайд 3 (Цели и задачи)

Целью работы является обеспечение частичного отказа от использования специализированной аппаратуры, предназначенной для сбора данных о состоянии дорог, благодаря ее замене на датчики мобильных устройств и увеличению объема собираемых данных. Это позволит упростить сам процесс сбора. Помимо этого система будет обрабатывать собранные данные для визуализации оценок состояния дорог.

Задачи приведены на слайде.

## Слайд 4 (Альтернативы)

Перед реализацией системы был осуществлен поиск и проведен анализ альтернатив для определения, существуют ли системы, решающие данную цель.

Итак, на слайде приведена таблица с критериями сравнения. Были найдены альтернативы:

- "Автострада" - формирует оценки по системе отзывов, оставляемых пользователями вручную, 
- "XWeather RoadAI" - проводит детальный анализ при помощи зафиксированной на дороге камеры и сложных алгоритмов компьютерного зрения, сами результаты не являются общедоступными, и 
- "Дороги России" - формирует оценки при помощи акселерометра с мобильных устройств, на которых и выполняются вычисления. Проект прекратил работу 10 лет назад, 

Таким образом, на момент начала работы такой работающей системы не обнаружилось.

## Слайд 5 (Архитектура системы)

На данном слайде приведена архитектура системы. Помимо мобильного приложения, которое предназначено для сбора и визуализации результатов, в системе существуют сервис пользовательских запросов, сервис прогнозирования и сервис обработки результатов, последний отвечает за буферизированную вставку в базу данных.

Прогнозирование результатов было вынесено из мобильного приложения, чтобы снизить нагрузку на телефон. 

На рисунке показаны два пути данных: верхний и нижний.

- Верхний отвечает за получение результатов: соответствует типовой клиент-серверной модели, используется формат сериализации JSON.
- Нижний - за непосредственный сбор данных. Остановимся на нем по подробнее.

Итак, с мобильных приложений по протоколу MQTT поступают данные акселерометра, гироскопа и GPS. Далее, через Kafka MQTT Proxy они попадают в топик monitoring объединенных в KRaft брокеров сообщений Kafka, где считываются сервисами прогнозирования, которые записывают результаты в топик points, и затем из топика points сервисы обработки результатов буферизированно вставляют результаты в СУБД Clickhouse.

Также отмечу, что в нижнем потоке используется формат Protobuf, чтобы снизить время сериализации и размер сообщений, а также обеспечить обратную совместимость.

В общих словах, такая архитектура системы был выбрана, чтобы обеспечить горизонтальное масштабирование. Более детально, как и обоснование самих компонентов системы, приведено в тексте пояснительной записки.

Также отмечу, что далее основное время будет уделено процессу сбора данных по причине ограниченности времени на выступление.

## Слайд 6 (Мобильное приложение)

На следующем слайде представлен интерфейс мобильного приложения, разработанного на Dart. 

Реализованы экраны:
- слева просмотр карты с состояниями дорожного покрытия с возможностью выбора на нижней панели параметров фильтрации и режима. При перемещении по карте одни и те же данные не запрашиваются снова, так как реализовано кеширование. Также можно заметить, что в приложение добавлены уведомления.
- далее - синхронизированные графики датчиков.
- третья - различные параметры конфигурации параметров приложения.
- и наконец, страница с логами.

На верхней панели слева направо кнопки включения сбора данных датчиков и сети.  При отключении сети данные временно сохраняются локально. Последняя кнопка для просмотра логов.

## Слайд 7 (Мобильное приложение)

Так как на некоторых дорогах отсутствует интернет, что не позволяет в моменте связываться с сервером, было реализовано локальное сохранение данных датчиков. Рассмотрим на процессе отправки:
1. На примере GPS, когда появляются новое значение, то есть возникает соответствующее ему событие, данные добавляются в буфер для отправки.
2. Если разность времен не больше некоторого значения, то при включенной сети этот буфер сериализуется и отправляется.
3. При возникновении ошибки или отсутствии сети данные сохраняются локально в файловой системе.

Таким образом, данные не теряются при отсутствии интернета или ошибках сети.

При возникновении интернета считывается K записанных буферов до тех пор пока не возникнет ошибка или записи не закончатся. Если считывание, сериализация и отправка прошли успешно, то подтверждается отправка K сообщений. В противном случае производится откат до I-ого сообщения и дальшейшая отправка прекращается. Для отправленных сообщений отчищаются ресурсы (удаляются локальные файлы).

Благодаря этому записи также не будут потеряны.

## Слайд 8 (Сервис прогнозирования)

Сервис прогнозирования, реализован на языке Python, многопроцессорно по причине GIL. Язык выбран благодаря наличию требуемых библиотек.

KafkaConsumer считывает сообщение из топика monitoring, далее ставит в очередь задачу, которая выполняется на отдельных процессах. На слайде представлен соответствующий механизм обработки.

После десериализации сообщения, осуществляется линейная интерполяция, поскольку данные датчиков мобильных устройств не приходят в строго определенные моменты времени, например раз в 50 миллисекунд.

Далее эти данные разбиваются на окна, так как размерность входов алгоритмов фиксирована. Смещение меньше целого окна, чтобы не пропустить дефекты на дорогах, если они произошли на границе.

После этого окна избавляются от шумов при помощи фильтра низких частот, выполняется экстракция признаков с использованием быстрого преобразования фурье, выборка из них наиболее коррелирующих с результатом, и, наконец, прогнозирование при помощи алгоритма машинного обучения. Далее результаты сериализуются и отправляются в топик points.

Таким образом, из данных датчиков формируются точки со значениями предсказаний в заданных географических координатах.

## Слайд 9 (Тестирование системы)

Тестирование системы.

Конфигурация представлена на экране.

Для этого был разработан сервис имитирующий работу нескольких мобильных устройств: он запускался на отдельном сервере, чтобы не создавать дополнительную нагрузку.

Результат тестирования следующий: 
- Отправлено 4200 сообщений с данными датчиков за 30 секунд.
- Время отправки составило 45 секунд.
- Время обработки заняло 150 секунд, получено 34 тысячи оценок.

## Слайд 10 (Тестирование системы)

На данном слайде представлены результаты тестирования различных алгоритмов регрессии: детерминированный (чтобы показать, время исполнения без некоторых этапов обработки), деревья регрессии, лес (Random Forest) и алгоритм градиентного бустинга XGBoost без учета скорости машины и с. Результаты сравнения представлены в таблице.

Выбор именно этих алгоритмов обусловлен задачей регрессии (а не классификации), малыми размерами модели (видно по времени исполнения) и типом входных данных (они хорошо показывают при работе с датчиками).

## Слайд 11 (Результаты на обучающих данных)

В результате, на основании скорости инференции и малой погрешности с истинными значениями были выбраны алгоритмы XGBoost с различными атрибутами.

Для визуализации точек используется функция градиента, где 0 - красная (дорога плохая), 1 - зеленый (дорога хорошая).

Несмотря на то, что на рисунке XGBoost со скоростью показывает лучшие результаты, он не был выбран для использования, так как из-за неполного покрытия сценариев датасета (там фиксирована скорость транспортного средства на участках), на реальных данных он менее чувствителен к дефектам на дорогам.

## Слайд 12 (Работа в реальных условиях)

На данном слайде вы можете видеть полученные результаты в реальных сценариях использования. На момент выступления сервис доступен: водители, используя кроссплатформенное мобильное приложение, могут помогать собирать данные о текущем состоянии дорог, а также видеть соответствующие результаты.

## Слайд 13 (Достигнутые результаты)

Таким образом, в результате выполнения ВКР были достигнуты следующие результаты:
- произведен анализ предметной области и аналогов;
- разработана архитектура и реализованы необходимые компоненты системы для обеспечения сбора данных и визуализации результатов;
- так как использовались алгоритмы обучения, был найден датасет и обучены алгоритмы машинного обучения;
- далее, произведен анализ алгоритмов и нагрузочное тестирование, для этого разработана соответствующая обвязка
- и наконец, была проверена работа системы в реальных условиях, чтобы убедиться в достижении цели

## Слайд 14 (Дальнейшее развитие)

Проделанная работа открывает дальнейшие перспективы, которые представлены на слайде. Так как разработанная система состоит из нескольких элементов, то направления развития сгруппированы в соответствии с ними.

## Слайд 15 (Конец)

Ниже приведена ссылка на репозиторий с исходным кодом проекта. Спасибо за внимание.
